<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Ä—ã–±–æ–ª–æ–≤–Ω—ã—Ö –º–µ—Å—Ç –æ—Ç –ú–∏—Ö–∞–ª—ã—á–∞</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://api-maps.yandex.ru/2.1/?apikey=5c8b83d1-0cfc-45c7-960c-0422eea91c23&lang=ru_RU" type="text/javascript"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; }
        .header { 
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white; 
            padding: 10px;
            text-align: center;
        }
        .header h1 { 
            font-size: 0.8em;
            margin-bottom: 5px; 
        }
        .header p { 
            font-size: 0.6em;
            opacity: 0.9; 
        }
        #map { 
            width: 100%; 
            height: calc(100vh - 80px);
        }
        .balloon-content {
            max-width: 300px;
            padding: 10px;
        }
        .balloon-photo {
            max-width: 100%;
            max-height: 200px;
            border-radius: 5px;
            margin-bottom: 8px;
        }
        .balloon-description {
            margin-bottom: 8px;
            line-height: 1.4;
            font-size: 14px;
        }
        .balloon-source {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
            font-size: 12px;
        }
        .balloon-source a {
            color: #3498db;
            text-decoration: none;
        }
        .balloon-source a:hover {
            text-decoration: underline;
        }
        .balloon-coords {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Ä—ã–±–æ–ª–æ–≤–Ω—ã—Ö –º–µ—Å—Ç –æ—Ç –ú–∏—Ö–∞–ª—ã—á–∞</h1>
        <p>–ù–∞–π–¥–∏—Ç–µ –ª—É—á—à–∏–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ä—ã–±–∞–ª–∫–∏ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</p>
    </div>
    
    <div id="map"></div>

    <script type="text/javascript">
        let map;
        let objectManager;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        ymaps.ready(init);

        function init() {
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç
            map = new ymaps.Map('map', {
                center: [55.7558, 37.6173],
                zoom: 10
                // –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã –≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            });

            // –°–æ–∑–¥–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –±–∞–ª—É–Ω–æ–≤
            objectManager = new ymaps.ObjectManager({
                clusterize: true,
                gridSize: 32,
                clusterDisableClickZoom: true
            });

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª—É–Ω–æ–≤
            objectManager.objects.options.set({
                preset: 'islands#blueFishingCircleIcon',
                balloonContentLayout: balloonLayout
            });

            objectManager.clusters.options.set({
                preset: 'islands#blueClusterIcons'
            });

            // –î–æ–±–∞–≤–ª—è–µ–º objectManager –Ω–∞ –∫–∞—Ä—Ç—É
            map.geoObjects.add(objectManager);

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –º–µ—Å—Ç–∞—Ö
            loadFishingPlaces();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Ä—ã–±–æ–ª–æ–≤–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
        function loadFishingPlaces() {
            fetch('./places.json')
                .then(response => response.json())
                .then(places => {
                    const features = places.map(place => ({
                        type: 'Feature',
                        id: place.id || Math.random(),
                        geometry: {
                            type: 'Point',
                            coordinates: place.coords
                        },
                        properties: {
                            balloonContent: createBalloonContent(place),
                            hintContent: 'üé£ –ú–µ—Å—Ç–æ –¥–ª—è —Ä—ã–±–∞–ª–∫–∏',
                            ...place
                        }
                    }));

                    objectManager.add(features);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –±–∞–ª—É–Ω–∞
        function createBalloonContent(place) {
            let content = `
                <div class="balloon-content">
                    <div style="font-weight: bold; margin-bottom: 8px; color: #2c3e50;">
                        üé£ –ú–µ—Å—Ç–æ –¥–ª—è —Ä—ã–±–∞–ª–∫–∏
                    </div>
            `;

            if (place.description) {
                content += `
                    <div class="balloon-description">${place.description}</div>
                `;
            }

            if (place.photo_url) {
                content += `
                    <img src="${place.photo_url}" alt="–§–æ—Ç–æ –º–µ—Å—Ç–∞" class="balloon-photo" 
                         onerror="this.style.display='none'">
                `;
            }

            if (place.source_link) {
                content += `
                    <div class="balloon-source">
                        <a href="${place.source_link.url}" target="_blank" rel="noopener">
                            ${place.source_link.text || '–ò—Å—Ç–æ—á–Ω–∏–∫'}
                        </a>
                    </div>
                `;
            }

            content += `
                    <div class="balloon-coords">
                        <b>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</b> ${place.coords[0].toFixed(6)}, ${place.coords[1].toFixed(6)}
                    </div>
                </div>
            `;

            return content;
        }

        // –ö–∞—Å—Ç–æ–º–Ω—ã–π layout –¥–ª—è –±–∞–ª—É–Ω–æ–≤
        var balloonLayout = ymaps.templateLayoutFactory.createClass(
            '<div class="balloon-content">$[properties.balloonContent]</div>'
        );
    </script>
</body>
</html>